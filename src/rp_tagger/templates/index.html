{% extends "base.html" %}
{% block title %}Unclassified Images{% endblock %}
{% block body %}
	<h2>Select an image</h2>
	<form action="/" method="get">
		<p>Search tags(Space-separated)</p>
		<input id="id_search_tags" name="search_tags" class="text">
	</form>
	<div id="image-list">
		<!--- Stuff goes here --->
	</div>
{% endblock %}
{% block domready %}
var page = 0;
var empty_page = false;
var block_request = false;

var tags = ""
let sp = new URLSearchParams(window.location.search)
var has = sp.has("search_tags")

if (has) {
	tags = sp.get("search_tags")
}
else {
	tags = ""
}

a=$.get('/data-images?page=' + page + '&tags='+ tags.toString(), function(data) {
	if (data == '') {
		empty_page == true;
	}
	else {
		block_request = false;
		$('#image-list').append(data);
	}
});


$(window).scroll(function() {
var margin = $(document).height() - $(window).height() - 200;
if ($(window).scrollTop() > margin && empty_page == false &&
block_request == false) {
	block_request = true;
		page += 1;
		let sp = new URLSearchParams(window.location.search)
		has = sp.has("search_tags")
		if (has) {
			tags = sp.get("search_tags")
		}
		else {
			tags = ""
		}
		$.get('/data-images?page=' + page + '&tags=' + tags.toString(), function(data) {
			if (data == '') {
				empty_page == true;
			}
			else {
				block_request = false;

				$('#image-list').append(data);

			}
		});
	}
});

var $input = $('#id_search_tags')

var SPACE = 32
var ENTER = 13

var tags_text = new Array()

var b = $('button')

var tags = b.wrapAll()

for (var i = 0; i < tags.length; ++i) {
	tags_text.push(tags[i].textContent);
	console.log(tags_text)
}

$input.focus()
{% endblock %}
